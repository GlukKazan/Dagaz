(define platform-step (
  $1 (verify empty?)
  add
))

(define pawn-shift (
  $1
  (if empty?
      add
      $1
  )
  (verify empty?)
  add
))

(define pawn-step (
  $1 (verify enemy?)
  add
))

(define step (
  $1 (verify not-friend?)
  add
))

(define leap (
  $1 $2 (verify not-friend?)
  add
))

(define slide (
  $1 
  (while empty? add $1)
  (verify not-friend?)
  add
))

(game
  (title "Platform Chess")
  (history "Copyrigt (c) 2001 Robert Price.")

  (move-sound "Audio\Pickup.wav")
  (release-sound "Audio\Pickup.wav")
  (capture-sound "")
  (drop-sound "")

  (option "animate captures"   false)

  (players White Black)
  (turn-order White Black)

  (board
     (image "images/blank.bmp")
     (grid
         (start-rectangle 2 2 138 138)
         (dimensions
           ("1/2/3/4" (136 0)) ; files
           ("a/b/c/d" (0 136)) ; ranks
         )
         (directions 
           (n 0 -1) (s 0 1) (e 1 0) (w -1 0)
         )
     )
     (grid
         (start-rectangle 12 12 60 60)
         (dimensions
           ("a/b/c/d/e/f/g/h" (68 0)) ; files
           ("8/7/6/5/4/3/2/1" (0 68)) ; ranks
         )
         (directions 
              (n 0 -1) (s 0 1) (e 1 0) (w -1 0)
              (nw -1 -1) (sw -1 1) (ne 1 -1) (se 1 1)
         )
     )
     (links up
         (1d a1) (a1 a2) (a2 b1) (b1 b2)
         (1c a3) (a3 a4) (a4 b3) (b3 b4)
         (1b a5) (a5 a6) (a6 b5) (b5 b6)
         (1a a7) (a7 a8) (a8 b7) (b7 b8)
         (2d c1) (c1 c2) (c2 d1) (d1 d2)
         (2c c3) (c3 c4) (c4 d3) (d3 d4)
         (2b c5) (c5 c6) (c6 d5) (d5 d6)
         (2a c7) (c7 c8) (c8 d7) (d7 d8)
         (3d e1) (e1 e2) (e2 f1) (f1 f2)
         (3c e3) (e3 e4) (e4 f3) (f3 f4)
         (3b e5) (e5 e6) (e6 f5) (f5 f8)
         (3a e7) (e7 e8) (e8 f7) (f7 f8)
         (4d g1) (g1 g2) (g2 h1) (h1 h2)
         (4c g3) (g3 g4) (g4 h3) (h3 h4)
         (4b g5) (g5 g6) (g6 h5) (h5 h6)
         (4a g7) (g7 g8) (g8 h7) (h7 h8)
     )
     (links down
         (a1 1d) (a2 1d) (b1 1d) (b2 1d)
         (a3 1c) (a4 1c) (b3 1c) (b4 1c)
         (a5 1b) (a6 1b) (b5 1b) (b6 1b)
         (a7 1a) (a8 1a) (b7 1a) (b8 1a)
         (c1 2d) (c2 2d) (d1 2d) (d2 2d)
         (c3 2c) (c4 2c) (d3 2c) (d4 2c)
         (c5 2b) (c6 2b) (d5 2b) (d6 2b)
         (c7 2a) (c8 2a) (d7 2a) (d8 2a)
         (e1 3d) (e2 3d) (f1 3d) (f2 3d)
         (e3 3c) (e4 3c) (f3 3c) (f4 3c)
         (e5 3b) (e6 3b) (f5 3b) (f6 3b)
         (e7 3a) (e8 3a) (f7 3a) (f8 3a)
         (g1 4d) (g2 4d) (h1 4d) (h2 4d)
         (g3 4c) (g4 4c) (h3 4c) (h4 4c)
         (g5 4b) (g6 4b) (h5 4b) (h6 4b)
         (g7 4a) (g8 4a) (h7 4a) (h8 4a)
     )
  )

  (piece
     (name Platform)
     (image White "images/white.bmp"
            Black "images/black.bmp")
     (moves
         (platform-step n) (platform-step s) (platform-step w) (platform-step e) 
     )
  )
  (piece
     (name Pawn)
     (image White "images/wpawn.bmp"
            Black "images/bpawn.bmp")
     (moves
         (pawn-shift n) (pawn-step nw) (pawn-step ne)
     )
  )
  (piece
     (name Rook)
     (image White "images/wrook.bmp"
            Black "images/brook.bmp")
     (moves
         (slide n) (slide s) (slide w) (slide e)
     )
  )
  (piece
     (name Knight)
     (image White "images/wknight.bmp"
            Black "images/bknight.bmp")
     (moves
         (leap n nw) (leap n ne) (leap s sw) (leap s se)
         (leap w nw) (leap w sw) (leap e ne) (leap e se)
     )
  )
  (piece
     (name Bishop)
     (image White "images/wbishop.bmp"
            Black "images/bbishop.bmp")
     (moves
         (slide nw) (slide sw) (slide ne) (slide se)
     )
  )
  (piece
     (name Queen)
     (image White "images/wqueen.bmp"
            Black "images/bqueen.bmp")
     (moves
         (slide n) (slide s) (slide w) (slide e)
         (slide nw) (slide sw) (slide ne) (slide se)
     )
  )
  (piece
     (name King)
     (image White "images/wking.bmp"
            Black "images/bking.bmp")
     (moves
         (step n) (step s) (step w) (step e)
         (step nw) (step sw) (step ne) (step se)
     )
  )

  (board-setup
    (White 
         (Platform 1c 1d 2d 3d 4d 4c)
         (Pawn a2 b2 c2 d2 e2 f2 g2 h2)
         (Rook a1 h1)
         (Knight b1 g1)
         (Bishop c1 f1)
         (Queen d1)
         (King e1)
    )
    (Black 
         (Platform 1b 1a 2a 3a 4a 4b)
         (Pawn a7 b7 c7 d7 e7 f7 g7 h7)
         (Rook a8 h8)
         (Knight b8 g8)
         (Bishop c8 f8)
         (Queen d8)
         (King e8)
    )
  )
)
